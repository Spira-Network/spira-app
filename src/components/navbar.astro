---
import '@fontsource/montserrat/latin-600.css'

import { Globe2 } from 'lucide-react'
import NavbarDropdown from './navbar-dropdown'
import Connect from './connect.astro'
import { cn } from '@/lib/utils'

interface Props {
    whiteNav?: boolean
}

const { whiteNav = false } = Astro.props
---

<nav-bar white-nav={whiteNav} class='pl-20 pr-20 flex justify-between fixed w-screen z-10 items-center'>
    <a href='/' class='h-1/6' aria-label='navigate to index page'>
        <img src='horizontal.png' alt='spira horizontal logo' class='max-w-[250px] max-h-[100px] aspect-auto' />
    </a>
    <ul class={cn('flex items-center gap-10 font-montserrat font-semibold', whiteNav && 'text-white')}>
        <li><a href='home' aria-label='navigate to home page'>Home</a></li>
        <li><Connect /></li>
        <li><a href='events'><Globe2 height={32} width={32} /></a></li>
        <li><NavbarDropdown client:only='react' /></li>
    </ul>
</nav-bar>

<script>
    class NavBar extends HTMLElement {
        private content: HTMLElement | null = null
        private whiteNav: boolean = false

        constructor() {
            super()
        }

        connectedCallback() {
            this.whiteNav = this.getAttribute('white-nav') === 'true'

            this.content = document.querySelector('main')
            if (this.content) {
                this.content.addEventListener('scroll', this.scrollEvent.bind(this))
            }

            this.styleWhiteNav()
        }

        disconnectedCallback() {
            if (this.content) {
                this.content.removeEventListener('scroll', this.scrollEvent.bind(this))
            }
        }

        scrollEvent() {
            const classes = ['backdrop-filter', 'backdrop-blur-md', 'shadow-md']
            if (this.content && this.content.scrollTop > 50) {
                this.classList.add(...classes)
            } else {
                this.classList.remove(...classes)
            }
        }

        styleWhiteNav() {
            if (this.whiteNav) {
                const navbarList = this.querySelector('.navbar-list')
                if (navbarList) {
                    navbarList.classList.add('text-white')
                }
            }
        }
    }

    customElements.define('nav-bar', NavBar)
</script>
